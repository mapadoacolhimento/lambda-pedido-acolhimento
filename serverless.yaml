service: create-support-request-api

frameworkVersion: "3"
useDotenv: true

package:
  patterns:
    - '!node_modules/.prisma/client/libquery_engine-*'
    - 'node_modules/.prisma/client/libquery_engine-rhel-*'
    - '!node_modules/prisma/libquery_engine-*'
    - '!node_modules/@prisma/engines/**'

custom:
  webpack:
    includeModules: true
    packagerOptions:
      scripts:
        - npx prisma generate
        - find . -name "libquery_engine-*" -not -name "libquery_engine-rhel-openssl-*" | xargs rm
  serverless-offline:
    httpPort: 5000
    ignoreJWTSignature: true

provider:
  name: aws
  runtime: nodejs18.x
  region: ${env:AWS_REGION}
  httpApi:
    metrics: true
    cors: true
    authorizers:
      auth:
        type: request
        functionName: auth
        identitySource: $request.header.Authorization
  environment:
    JWT_SECRET: ${env:JWT_SECRET}
    DATABASE_URL: ${env:DATABASE_URL}

functions:
  auth:
    handler: handler.auth

  create:
    handler: handler.create
    events:
      - httpApi:
          path: /create
          method: POST
          authorizer:
            name: auth
            type: request

  process:
    handler: handler.process
    events:
      - httpApi:
          path: /process
          method: POST
          authorizer:
            name: auth
            type: request

  sign:
    handler: handler.sign
    events:
      - httpApi:
          path: /sign
          method: GET

plugins:
  - serverless-webpack
  - serverless-offline
